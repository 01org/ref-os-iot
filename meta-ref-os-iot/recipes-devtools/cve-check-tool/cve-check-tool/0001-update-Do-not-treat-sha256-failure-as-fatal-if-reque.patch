From 8a5890af2ffd79f7f258377f56c98ce5c1a6bde4 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <michael.i.doherty@intel.com>
Date: Thu, 23 Feb 2017 10:17:43 +0000
Subject: [PATCH] update: Do not treat sha256 failure as fatal if requested

The NVD database is known to have issues during early morning whereby
the meta files don't actually match the sha256 of the target xml feed.
This has caused problems for some users of cve-check-tool, so in this
case we will now continue as if nothing fatal had happened if we find
the CVE_SKIP_VERIFY variable in the environment.

Signed-off-by: Ikey Doherty <michael.i.doherty@intel.com>
---
 src/update.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/update.c b/src/update.c
index 7c4d635..cf9afe6 100644
--- a/src/update.c
+++ b/src/update.c
@@ -368,7 +368,10 @@ refetch:
                         }
                         fprintf(stderr, "Unpacked data %s is not consistent\n",
                                 nvdcve_data->str);
-                        return -1;
+                        /* If CVE_SKIP_VERIFY is set in the environment, don't bail here */
+                        if (!getenv("CVE_SKIP_VERIFY")) {
+                                return -1;
+                        }
                 }
         }
 
-- 
2.7.4

